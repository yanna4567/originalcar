# ROS Driver

The ROS Driver node exposes Aurora sensor streams to ROS.

# Install and uninstall deptrum-ros-driver debian pakage
- `sudo dpkg -i ros-[ROS_DISTRO]-deptrum-ros-driver-aurora930_[version]-0[Ubuntu DISTRIB_CODENAME]_amd64.deb` : Install deptrum-ros-driver
- `sudo dpkg --purge ros-[ROS_DISTRO]-deptrum-ros-driver-aurora930`: Uninstall deptrum-ros-driver-aurora930
## Set Environment Variable
  If multiple devices are installed, in order to prevent chaos caused by communication between nodes in the local area network, different environment variables must be set for each device,for example `export ROS_DOMAIN_ID=5`
## Launch Ros Driver Node

After the Ros Driver is installed, first you must use `source /opt/ros/[ROS_DISTRO]/setup.bash`, you can run this to launch the ros driver: `ros2 launch deptrum-ros-driver-aurora930 aurora930_launch.py`

To set parameters, can modify launch file

 - `depth_enable ` (default=`true`) : Enable or disable the depth frame
 - `ir_enable ` (default=`true`) : Enable or disable the ir frame
 - `rgb_enable ` (default=`true`) : Enable or disable the rgb frame
 - `point_cloud_enable ` (default=`true`) : Generate a point cloud from depth data. Requires depth_enable
 - `usb_port_number` (default=``) : The device is created through USB port number,  you can set with usb port number;
 - `rgbd_enable` (default=`false`): Enable or disable the rgbd frame, if rgbd mode enable, the depth frame，rgb frame， ir frame， point cloud get from rgbd frame
 - `exposure_enable` (default=`false`):  Enable or disable to set camera exposure time
 - `exposure_time` (default=`1`):  Set the exposure time for the camera(not set `exposure_enable` default AE. range in [1-31])
 - `gain_enable` (default=`false`):  Enable or disable to set camera gain
 - `gain_value` (default=`20`):  Set the gain value  for the camera(not set `exposure_enable` default AE. range in [10-160))
 - `resolution_mode_index` (default=`0`):  Set Mode resolution index default `0`, see the launch file for details
 - `threshold_size` (default=`110`): Set remove filter size. range in [30-400]
 - `ir_fps` (default=`15`): Fps to run ir cameras. Valid options are 5 or 10 or 12 or 15
 - `rgb_fps` (default=`15`): Fps to run rgb cameras. must set less than or equal to ir_fps, Otherwise, it will not take effect
 - `depth_correction` (default=`false`): Enable or disable depth correction, make sense when align_mode is true and ir resolution is equal to rgb resolution
 - `align_mode` (default=`false`): Enable or disable align rgbd-ir
 - `minimum_filter_depth_value` (default=`150`): minimum filter depth value,if firmware version is v1.7.3,range in [150-300] is ineffective
 - `maximum_filter_depth_value` (default=`4000`): maximum filter depth value
 - `laser_power` (default=`1.0`):  adjust laser driver 1-auto 2-indoor 3-outdoor
 - `log_dir` (default=`/tmp`) : The log path storage ;

## Topics

The node emits a variety of topics into its namespace.

- `depth/image_raw` (`sensor_msgs::Image`) : The raw image from the depth camera, in 16UC1 format. 
- `rgb/image_raw` (`sensor_msgs::Image`) : The raw image from the color camera, in BGR888 format. 
- `ir/image_raw` (`sensor_msgs::Image`) : The raw infrared image from the ir camera sensor. 
- `points2` (`sensor_msgs::PointCloud2`) : The point cloud generated by the Aurora SDK from the depth camera data. 
- `rgb/camera_info` (`sensor_msgs::CameraInfo`) : Calibration information for the color camera, converted from Aurora SDK format. 
- `ir/camera_info` (`sensor_msgs::CameraInfo`) : Calibration information for the ir camera, converted from Aurora SDK format.

## Visualization on rviz

Use rviz to visualize aurora topics mesages: `ros2 run rviz2 rviz2`

Set [Global Options] -> [Fixed Frame] = `depth_camera_link`

Add [By topic] -> /depth/image_raw/image
               -> /ir/image_raw/image
               -> /rgb/image_raw/image
               -> /points2/PointCloud2

## Log
Log information is stored in the/tmp directory,You can view the latest logs through the soft link `/tmp/node.INFO`,the log file format
is `deptrum_ros_driver_*`

## Visualization on rviz config

Use rviz to visualize aurora topics mesages: `ros2 launch deptrum-ros-driver-aurora930 viewer930_launch.py`

Set [Displays] -> [ir] = `enable`
Set [Displays] -> [depth] = `enable`
Set [Displays] -> [rgb] = `enable`

